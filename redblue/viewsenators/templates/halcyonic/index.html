<!DOCTYPE HTML>
<!--
	Halcyonic by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
{% load static %}
<html>
	<head>
		<title>Red Friends, Blue Friends: Asking your Facebook friends to contact their senators</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="{% static 'halcyonic/assets/js/ie/html5shiv.js' %}"></script><![endif]-->
		<link rel="stylesheet" href="{% static 'viewsenators/map.css' %}" />
		<link rel="stylesheet" href="{% static 'halcyonic/assets/css/main.css' %}" />
		<!--[if lte IE 9]><link rel="stylesheet" href="{% static 'halcyonic/assets/css/ie9.css' %}" /><![endif]-->
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
function setColor(colorIdxToNotTouch) {
    var gray="rgb(213,222,217)"
    d3.selectAll("path").filter(
        function(d) { return (d.properties.colorBitmask & (1<<colorIdxToNotTouch)) == 0 })
        .style('fill', gray)
        .style('transition', '0.5s')
}
function restoreColors() {
    for (var idx in bitmaskToColor) {
        $( "path[colorBitmask='" + idx + "']" ).css('fill',
            function() { return bitmaskToColor[idx] } );
    }
    $( "path[colorBitmask='0']" ).css('fill', '#000' );
}

{% for cl in contactLists %}
$(document).ready(function(){
    $( "a[id='href_{{cl.id}}']" ).mouseenter(function(){setColor({{forloop.counter0}})});
});
{% endfor %}
$(document).ready(function(){
    $( "a[name='party']" ).mouseleave(function(){restoreColors()});
});

</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-98881488-1', 'auto');
  ga('send', 'pageview');
</script>

	</head>
	<body>
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header-wrapper">
					<header id="header" class="container">
						<div class="row">
							<div class="12u">

								<!-- Logo -->
									<h1><a href="#" id="logo">Red Friends, Blue Friends</a></h1>

								<!-- Nav -->
									<nav id="nav">
										<a href="index">Home</a>
										<a href="choose">Generate your own list</a>
										<a href="combine">Combine existing lists</a>
									</nav>

							</div>
						</div>
					</header>
					<div id="banner">
						<div class="container">
							<div class="row">
								<div class="12u(mobile)">
									<!-- Banner Copy -->
										<p>Influence Senate votes by asking your Facebook friends to message their senators.</p>
								</div>
							</div>
						</div>
					</div>
				</div>

			<!-- Features -->
				<div id="features-wrapper">
					<div id="features">
						<div class="container">
							<div class="row">
{% for cl in contactLists %}
								<div class="{{contactLists|length|add:"1"}}u 12u(mobile)" align="center">
										<section>
											Click to search Facebook:<br>
											<a href="{{ cl.fbUrl }}" id="href_{{ cl.id }}" name="party" class="button-big">{{ cl.title }}</a>
											<p>
												{{ cl.description }}
											</p>
										</section>
								</div>
{% endfor %}
							</div>
						</div>
					</div>
				</div>

			<!-- Content -->
				<div id="content-wrapper">
					<div id="content">
						<div class="container">
							<div class="row">
								<div style="width:100%">
										<section id="map">

<script type="text/javascript">
/* 

This visualization was made possible by modifying code from:
http://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922

Which in turn was modified from:
Scott Murray, Choropleth example from "Interactive Data Visualization for the Web" 
https://github.com/alignedleft/d3-book/blob/master/chapter_12/05_choropleth.html   
        
Malcolm Maclean, tooltips example tutorial
http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html

Mike Bostock, Pie Chart Legend
http://bl.ocks.org/mbostock/3888852  */

        
//Width and height of map
var width = 960;
var height = 500;

// D3 Projection
var projection = d3.geo.albersUsa()
                   .translate([width/2, height/2])    // translate to center of screen
                   .scale([1000]);          // scale things down so see entire US
        
// Define path generator
var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
               .projection(projection);  // tell path generator to use albersUsa projection

        
// Define linear scale for output
var bitmaskToColor = {{ bitmaskToColor|safe }};

var legendText = {{ legendText|safe }};

//Create SVG element and append map to the SVG
var svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
        
// Append Div for tooltip to SVG
var div = d3.select("#map")
            .append("div")   
            .attr("class", "tooltip")               
            .style("opacity", 0);

// Load in my states data!
{% load static %}
d3.json( "{% static 'viewsenators/us-states.json' %}", function(json) {

// Find the corresponding state inside the GeoJSON
for (var j = 0; j < json.features.length; j++)  {
    var d3State = json.features[j].properties.name;

    {% for pyState, colorBitmask in stateToBitmasks.items %}
        {% if forloop.counter0 == 0 %}
            if
        {% else %}
            else if
        {% endif %}
        ("{{ pyState.name }}" == d3State) {
            json.features[j].properties.colorBitmask = {{ colorBitmask }}; 
            continue
        }
    {% endfor %}
        else {
            json.features[j].properties.colorBitmask = 0; 
        }
}
        
// Bind the data to the SVG and create one path per GeoJSON feature
svg.selectAll("path")
    .data(json.features)
    .enter()
    .append("path")
    .attr("d", path)
    .attr("colorBitmask", function(d) { return d.properties.colorBitmask } )
    .style("stroke", "#fff")
    .style("stroke-width", "1")
    .style("fill", function(d) { return bitmaskToColor[d.properties.colorBitmask]; });

// Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852
var legend = d3.select("body").append("svg")
                  .attr("class", "legend")
                 .attr("width", 340)
                .attr("height", 200)
                   .selectAll("g")
                   .data(d3.values(bitmaskToColor))
                   .enter()
                   .append("g")
                 .attr("transform", function(d, i) { return "translate(0," + i * 25 + ")"; });

      legend.append("rect")
             .attr("width", 18)
             .attr("height", 18)
             .style("fill", function(d, i) { return d3.values(bitmaskToColor)[i]; });

      legend.append("text")
            .data(d3.values(legendText))
            .attr("x", 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .text(function(d) { return d; });
});
</script>
										</section>

								</div>
							</div>
						</div>
					</div>
				</div>

			<!-- Footer -->
				<div id="footer-wrapper">
					<footer id="footer" class="container">
						<div class="row">
							<div class="3u 12u(mobile)">

								<!-- Links -->
									<section>
										<h2>Acknowledgements</h2>
										<div>
											<div class="row">
												<div>
													<ul class="link-list last-child">
														<li>Senator data from <a href="https://propublica.github.io/congress-api-docs/">ProPublica Congress API</a></li>
														<li>D3 Map visualization by <a href="http://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922">Michelle Chandra</a></li>
														<li>Insipired by <a href="http://www.indivisibleberkeley.org">Indivisible Berkeley</a></li>
														<li>Available open-source on <a href="https://github.com/artoonie/RedStatesBlueStates">github</a></li>
														<li>Created by <a href="http://www.arminsamii.com">Armin Samii</a></li>
													</ul>
												</div>
											</div>
										</div>
									</section>

							</div>
							<div class="9u 12u(mobile)">
									<section>
										<h2>FAQ</h2>
										<p>
										<h3>Why can't I search directly on facebook instead of using this site?</h3><br>
										Facebook won't understand your request if you search "My friends who live in California or live in Arizona".<br>
										This site generates a URL which Facebook does understand.
										<br><br>
										
										<h3>Can this work for congresspeople as well?</h3><br>
										Not yet, due to the complex boundaries caused by gerrymandering.
										</p>
									</section>
							</div>
						</div>
					</footer>
				</div>

			<!-- Copyright -->
				<div id="copyright">
					&copy; Armin Samii | Design: <a href="http://html5up.net">HTML5 UP</a>
				</div>

		</div>

		<!-- Scripts -->
			<script src="{% static 'halcyonic/assets/js/jquery.min.js' %}"></script>
			<script src="{% static 'halcyonic/assets/js/skel.min.js' %}"></script>
			<script src="{% static 'halcyonic/assets/js/skel-viewport.min.js' %}"></script>
			<script src="{% static 'halcyonic/assets/js/util.js' %}"></script>
			<!--[if lte IE 8]><script src="{% static 'halcyonic/assets/js/ie/respond.min.js' %}"></script><![endif]-->
			<script src="{% static 'halcyonic/assets/js/main.js' %}"></script>

	</body>
</html>
